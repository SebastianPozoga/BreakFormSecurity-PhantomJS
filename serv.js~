var page = require('webpage').create();
page.onConsoleMessage = function (msg) {
    console.log('Page console: ' + msg);
};
page.open("protectedForm.html", function (status) {
    if (status !== 'success') {
        console.log('Unable to load the address!');
    } else {
        /*page.evaluate(function() {
                var list = document.querySelectorAll('span.status');
                for (var i = 0; i < list.length; ++i) {
                    console.log((i + 1) + ": " + list[i].innerHTML.replace(/<.*?>/g, ''));
                }
            });*/
        page.includeJs("http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js", function() {
		$(document).ready(function(){
			$('#submit').click();
			console.log('secret code:'+$('#code').html());
		});
        });
        var code = page.evaluate(function() {
            $('#submit').click();
            return $('#code').html();
        });
        console.log('my log'+code);
	phantom.exit();
    }
});
